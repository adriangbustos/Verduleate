<body>

  <div class="container">
    <!-- Sidebar Section -->
    <aside>
      <div class="toggle">
        <div class="logo">
          <img src="../../../assets/LogoCompleto.png">
        </div>
        <div class="close" id="close-btn">
          <i class="pi pi-times"></i>
        </div>
      </div>

      <div class="sidebar">
        <a href="#" class="active">
          <i class="pi pi-chart-line"></i>
          <h3>Panel Principal</h3>
        </a>
        <a href="#">
          <i class="pi pi-users"></i>
          <h3>Usuarios</h3>
        </a>
        <a (click)="goToChat()">
          <i class="pi pi-comments"></i>
          <h3>Chat</h3>
        </a>
        <a href="#">
          <i class="pi pi-chart-bar"></i>
          <h3>Analíticas</h3>
        </a>
        <a href="#">
          <i class="pi pi-envelope"></i>
          <h3>Tickets</h3>
        </a>
        <a href="#">
          <i class="pi pi-shopping-cart"></i>
          <h3>Lista de Ventas</h3>
        </a>
        <a href="#">
          <i class="pi pi-file-pdf"></i>
          <h3>Reportes</h3>
        </a>
        <a href="#">
          <i class="pi pi-cog"></i>
          <h3>Configuración</h3>
        </a>
        <a href="#">
          <i class="pi pi-plus-circle"></i>
          <h3>Nuevo Inicio</h3>
        </a>
        <a (click)="logout()"id='signout'>
          <i class="pi pi-sign-out"></i>
          <h3>Cerrar Sesión</h3>
        </a>
      </div>
    </aside>
    <!-- End of Sidebar Section -->

    <!-- Main Content -->
    <main>
      <h1>Panel Principal</h1>
      <!-- Analyses -->
      <div class="analyse">
        <div class="sales">
          <div class="status">
            <div class="info">
              <h3>Usuarios</h3>
              <h1>{{ formatNumber(analytics.users.count) }}</h1>
            </div>
            <div class="progresss">
              <svg>
                <circle cx="38" cy="38" r="36"></circle>
              </svg>
              <div class="percentage">
                <p>{{ analytics.users.percentage > 0 ? '+' : '' }}{{ analytics.users.percentage }}%</p>
              </div>
            </div>
          </div>
        </div>
        <div class="visits">
          <div class="status">
            <div class="info">
              <h3>Visitas</h3>
              <h1>{{ formatNumber(analytics.visits.count) }}</h1>
            </div>
            <div class="progresss">
              <svg>
                <circle cx="38" cy="38" r="36"></circle>
              </svg>
              <div class="percentage">
                <p>{{ analytics.visits.percentage > 0 ? '+' : '' }}{{ analytics.visits.percentage }}%</p>
              </div>
            </div>
          </div>
        </div>
        <div class="searches">
          <div class="status">
            <div class="info">
              <h3>Búsquedas</h3>
              <h1>{{ formatNumber(analytics.searches.count) }}</h1>
            </div>
            <div class="progresss">
              <svg>
                <circle cx="38" cy="38" r="36"></circle>
              </svg>
              <div class="percentage">
                <p>{{ analytics.searches.percentage > 0 ? '+' : '' }}{{ analytics.searches.percentage }}%</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End of Analyses -->

      <!-- New Users Section -->
      <div class="new-users">
        <h2>Nuevos Usuarios</h2>
        <div class="user-list">
          <div class="user" *ngFor="let user of newUsers" (click)="viewUserDetails(user)">
            <h2>{{ user.displayName || user.email }}</h2>
            <p>{{ getTimeAgo(user.createdAt) }}</p>
            <span class="user-type" [class.comprador]="user.type === 'Comprador'" [class.agricultor]="user.type === 'Agricultor'">{{ user.type }}</span>
          </div>
          <div class="user" *ngIf="newUsers.length === 0">
            <p>No hay nuevos usuarios</p>
          </div>
        </div>
      </div>
      <!-- End of New Users Section -->

      <!-- Recent Orders Table -->
      <div class="recent-orders">
        <h2>Pedidos Recientes</h2>
        <table>
          <thead>
            <tr>
              <th>Nombre del Curso</th>
              <th>Número de Curso</th>
              <th>Pago</th>
              <th>Estado</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of orders">
              <td>{{ order.productName }}</td>
              <td>{{ order.productNumber }}</td>
              <td>{{ order.paymentStatus }}</td>
              <td [class]="getStatusClass(order.status)">{{ order.status }}</td>
              <td class="primary">Detalles</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- End of Recent Orders -->

    </main>
    <!-- End of Main Content -->

    <!-- Right Section -->
    <div class="right-section">
      <div class="nav">
        <button id="menu-btn">
          <i class="pi pi-bars"></i>
        </button>
        <div class="dark-mode">
          <i class="pi pi-moon active"></i>
          <i class="pi pi-sun"></i>
        </div>


      </div>
      <!-- End of Nav -->

      <div class="user-profile">
        <div class="logo">
          <h2>Adrián Garrido</h2>
          <p>Administrador</p>
        </div>
      </div>

      <div class="reminders">
        <div class="header">
          <h2>Recordatorios</h2>
          <i class="pi pi-bell"></i>
        </div>

        <div class="notification" *ngFor="let reminder of reminders" [class.deactive]="reminder.type === 'inactive'">
          <div class="icon" (click)="toggleReminderType(reminder)">
            <i [class]="reminder.type === 'active' ? 'pi pi-volume-up' : 'pi pi-volume-off'"></i>
          </div>
          <div class="content">
            <div class="info">
              <h3>{{ reminder.title }}</h3>
              <small class="text_muted">{{ reminder.time }}</small>
            </div>
            <div class="reminder-actions">
              <i class="pi pi-pencil" (click)="editReminder(reminder)" title="Edit"></i>
              <i class="pi pi-trash" (click)="deleteReminder(reminder)" title="Delete"></i>
            </div>
          </div>
        </div>

        <!-- Add/Edit Reminder Form -->
        <div class="notification reminder-form" *ngIf="showAddReminderForm">
          <div class="form-content">
            <h3>{{ editingReminder ? 'Editar Recordatorio' : 'Nuevo Recordatorio' }}</h3>
            <input 
              type="text" 
              [(ngModel)]="newReminderTitle" 
              placeholder="Título del recordatorio"
              class="reminder-input"
            >
            <input 
              type="text" 
              [(ngModel)]="newReminderTime" 
              placeholder="Hora (ej: 08:00 AM - 12:00 PM)"
              class="reminder-input"
            >
            <div class="form-buttons">
              <button (click)="editingReminder ? saveEditedReminder() : addReminder()" class="save-btn">
                <i class="pi pi-check"></i> {{ editingReminder ? 'Guardar' : 'Agregar' }}
              </button>
              <button (click)="cancelReminderForm()" class="cancel-btn">
                <i class="pi pi-times"></i> Cancelar
              </button>
            </div>
          </div>
        </div>

        <div class="notification add-reminder" (click)="openAddReminderForm()" *ngIf="!showAddReminderForm">
          <div>
            <i class="pi pi-plus"></i>
            <h3>Agregar Recordatorio</h3>
          </div>
        </div>

      </div>

    </div>


  </div>

  <!-- User Details Modal -->
  <div class="modal-overlay" *ngIf="showUserModal" (click)="closeUserModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Información del Usuario</h2>
        <i class="pi pi-times" (click)="closeUserModal()"></i>
      </div>
      
      <div class="modal-body" *ngIf="selectedUser">
        <div class="user-info-grid">
          <div class="info-item">
            <label>Nombre Completo:</label>
            <p>{{ selectedUser.fullname || 'No especificado' }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.type === 'Agricultor' && selectedUser.fincaname">
            <label>Nombre de Finca:</label>
            <p>{{ selectedUser.fincaname }}</p>
          </div>
          
          <div class="info-item">
            <label>Email:</label>
            <p>{{ selectedUser.email }}</p>
          </div>
          
          <div class="info-item">
            <label>Tipo de Usuario:</label>
            <p>
              <span class="user-type-badge" [class.comprador]="selectedUser.type === 'Comprador'" [class.agricultor]="selectedUser.type === 'Agricultor'">
                {{ selectedUser.type }}
              </span>
            </p>
          </div>
          
          <div class="info-item">
            <label>Email Verificado:</label>
            <p>{{ selectedUser.emailverificado ? 'Sí' : 'No' }}</p>
          </div>
          
          <div class="info-item">
            <label>Onboarding Completado:</label>
            <p>{{ selectedUser.onboarding ? 'Sí' : 'No' }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.cellphone">
            <label>Teléfono:</label>
            <p>{{ selectedUser.cellphone }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.address">
            <label>Dirección:</label>
            <p>{{ selectedUser.address }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.birthday">
            <label>Fecha de Nacimiento:</label>
            <p>{{ getTimeAgo(selectedUser.birthday) }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.gender">
            <label>Género:</label>
            <p>{{ selectedUser.gender }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.advertisements">
            <label>Publicidad:</label>
            <p>{{ selectedUser.advertisements }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.type === 'Agricultor' && selectedUser.descripcionFinca">
            <label>Descripción de Finca:</label>
            <p>{{ selectedUser.descripcionFinca }}</p>
          </div>
          
          <div class="info-item" *ngIf="selectedUser.creationDate">
            <label>Fecha de Registro:</label>
            <p>{{ getTimeAgo(selectedUser.creationDate) }}</p>
          </div>
          
          <div class="info-item">
            <label>ID de Usuario:</label>
            <p class="user-id">{{ selectedUser.id }}</p>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="delete-user-btn" (click)="deleteUserAccount()">
          <i class="pi pi-trash"></i> Eliminar Usuario
        </button>
        <button class="close-modal-btn" (click)="closeUserModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>

</body>