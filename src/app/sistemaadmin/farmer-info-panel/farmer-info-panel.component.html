<!-- ============================================
     FARMER INFO PANEL - RIGHT SIDEBAR
     ============================================ -->

<div class="farmer-info-panel">
  
  <!-- ==================== PANEL HEADER ==================== -->
  <header class="panel-header">
    <div class="header-title">
      <span class="farmer-avatar-header">{{ getInitials() }}</span>
      <h3>{{ getFarmerName() }}</h3>
    </div>
    <div class="header-actions">
      <button class="btn-icon" (click)="onClose()" title="Cerrar panel">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- ==================== PROFILE SECTION ==================== -->
  <div class="panel-content">
    
    <!-- Farmer Avatar & Status -->
    <section class="profile-section">
      <div class="profile-avatar">
        {{ getInitials() }}
      </div>
      <h2 class="profile-name">{{ getFarmerName() }}</h2>
      <span class="profile-status" [class.active]="ticket.status === 'active'">
        {{ ticket.status === 'active' ? 'En conversaciÃ³n' : 'Sin atender' }}
      </span>
    </section>

    <!-- ==================== INFO CARDS ==================== -->
    <section class="info-section">
      
      <!-- Channel Info -->
      <div class="info-card">
        <div class="info-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
        </div>
        <div class="info-content">
          <span class="info-label">Canal</span>
          <span class="info-value">Web - Soporte</span>
        </div>
      </div>

      <!-- Ticket ID -->
      <div class="info-card">
        <div class="info-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <div class="info-content">
          <span class="info-label">ID del Ticket</span>
          <span class="info-value monospace">{{ ticket.id?.substring(0, 12) }}</span>
        </div>
      </div>

      <!-- Phone -->
      <div class="info-card">
        <div class="info-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
        </div>
        <div class="info-content">
          <span class="info-label">TelÃ©fono</span>
          <span class="info-value">{{ getPhone() }}</span>
        </div>
      </div>

      <!-- Address -->
      <div class="info-card">
        <div class="info-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
        </div>
        <div class="info-content">
          <span class="info-label">DirecciÃ³n</span>
          <span class="info-value address">{{ getAddress() }}</span>
        </div>
      </div>

    </section>

    <!-- ==================== ADDITIONAL ATTRIBUTES ==================== -->
    <section class="attributes-section">
      <h4 class="section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        Atributos adicionales
      </h4>
      
      <div class="attribute-list">
        <!-- Finca Name -->
        <div class="attribute-item">
          <span class="attribute-label">Finca</span>
          <span class="attribute-value">{{ getFincaName() }}</span>
        </div>
        
        <!-- Email -->
        <div class="attribute-item">
          <span class="attribute-label">Email</span>
          <span class="attribute-value">{{ getEmail() }}</span>
        </div>
        
        <!-- Ticket Created -->
        <div class="attribute-item">
          <span class="attribute-label">Ticket creado</span>
          <span class="attribute-value">{{ formatDate(ticket.createdAt) }}</span>
        </div>

        <!-- Account Created -->
        <div class="attribute-item" *ngIf="farmerProfile?.creationDate">
          <span class="attribute-label">Cuenta creada</span>
          <span class="attribute-value">{{ formatDate(farmerProfile.creationDate) }}</span>
        </div>
      </div>

      <button class="btn-add-attribute">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        AÃ±adir nuevo atributo
      </button>
    </section>

    <!-- ==================== NOTES SECTION ==================== -->
    <section class="notes-section">
      <button class="notes-toggle" (click)="toggleNotes()">
        <span class="toggle-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          Notas
        </span>
        <svg 
          class="toggle-arrow"
          [class.expanded]="isNotesExpanded()"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>

      <div class="notes-content" *ngIf="isNotesExpanded()">
        <div class="notes-input-wrapper">
          <textarea 
            class="notes-input"
            placeholder="Escribe una nota..."
            [value]="newNote()"
            (input)="newNote.set($any($event.target).value)"
            rows="3">
          </textarea>
          <div class="notes-actions">
            <button class="btn-emoji" title="AÃ±adir emoji">ðŸ˜Š</button>
            <button class="btn-attach" title="Adjuntar archivo">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Sample Notes -->
        <div class="notes-list">
          <div class="note-item">
            <div class="note-header">
              <span class="note-author">Sistema</span>
              <span class="note-date">{{ formatDate(ticket.createdAt) }}</span>
            </div>
            <p class="note-text">Ticket creado por el agricultor</p>
          </div>
        </div>
      </div>
    </section>

  </div>

</div>
